sap.ui.define(["sap/m/GroupHeaderListItem","sap/ui/Device","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","../model/formatter","./BaseController"],(e,t,s,i,r,o,a,n,l)=>{"use strict";return l.extend("sap.ui.yesco.controller.Master",{formatter:n,onInit(){const e=this.byId("list");const t=this._createViewModel();const s=e.getBusyIndicatorDelay();this._oGroupFunctions={UnitPrice(e){const t=this.getResourceBundle();const s=e.getProperty("UnitPrice");let i;let r;if(s<=20){i="LE20";r=t.getText("masterGroup1Header1")}else{i="GT20";r=t.getText("masterGroup1Header2")}return{key:i,text:r}}};this._oList=e;this._oListFilterState={aFilter:[],aSearch:[]};this.setModel(t,"masterView");e.attachEventOnce("updateFinished",function(){t.setProperty("/delay",s)});this.getView().addEventDelegate({onBeforeFirstShow:()=>{this.getOwnerComponent().oListSelector.setBoundMasterList(e)}});this.getRouter().getRoute("master").attachPatternMatched(this._onMasterMatched,this);this.getRouter().attachBypassed(this.onBypassed,this)},onUpdateFinished(e){this._updateListItemCount(e.getParameter("total"))},onSearch(e){if(e.getParameters().refreshButtonPressed){this.onRefresh();return}const t=e.getParameter("query");if(t){this._oListFilterState.aSearch=[new i("ProductName",r.Contains,t)]}else{this._oListFilterState.aSearch=[]}this._applyFilterSearch()},onRefresh(){this._oList.getBinding("items").refresh()},onOpenViewSettings(e){let t="filter";if(e.getSource()instanceof sap.m.Button){const s=e.getSource().getId();if(s.match("sort")){t="sort"}else if(s.match("group")){t="group"}}if(!this.byId("viewSettingsDialog")){s.load({id:this.getView().getId(),name:"sap.ui.yesco.view.ViewSettingsDialog",controller:this}).then(e=>{this.getView().addDependent(e);e.addStyleClass(this.getOwnerComponent().getContentDensityClass());e.open(t)})}else{this.byId("viewSettingsDialog").open(t)}},onConfirmViewSettingsDialog(e){const t=e.getParameters().filterItems;const s=[];const o=[];t.forEach(e=>{switch(e.getKey()){case"Filter1":{s.push(new i("UnitPrice",r.LE,100));break}case"Filter2":{s.push(new i("UnitPrice",r.GT,100));break}default:{break}}o.push(e.getText())});this._oListFilterState.aFilter=s;this._updateFilterBar(o.join(", "));this._applyFilterSearch();this._applySortGroup(e)},_applySortGroup(e){const t=e.getParameters();const s=[];let i;let r;if(t.groupItem){i=t.groupItem.getKey();r=t.groupDescending;s.push(new o(i,r,this._oGroupFunctions[i]))}else{i=t.sortItem.getKey();r=t.sortDescending;s.push(new o(i,r))}this._oList.getBinding("items").sort(s)},onSelectionChange(e){const t=e.getSource();const s=e.getParameter("selected");if(!(t.getMode()==="MultiSelect"&&!s)){this._showDetail(e.getParameter("listItem")||e.getSource())}},onBypassed(){this._oList.removeSelections(true)},createGroupHeader(t){return new e({title:t.text,upperCase:false})},onNavBack(){history.go(-1)},_createViewModel(){const e=this.getResourceBundle();return new a({isFilterBarVisible:false,filterBarLabel:"",delay:0,title:e.getText("masterTitleCount",[0]),noDataText:e.getText("masterListNoDataText"),sortBy:"ProductName",groupBy:"None"})},_onMasterMatched(){this.getModel("appView").setProperty("/layout","OneColumn")},_showDetail(e){const s=!t.system.phone;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("ProductID")},s)},_updateListItemCount(e){if(this._oList.getBinding("items").isLengthFinal()){const t=this.getResourceBundle().getText("masterTitleCount",[e]);this.getModel("masterView").setProperty("/title",t)}},_applyFilterSearch(){const e=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter);const t=this.getModel("masterView");this._oList.getBinding("items").filter(e,"Application");if(e.length!==0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){t.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_updateFilterBar(e){const t=this.getModel("masterView");t.setProperty("/isFilterBarVisible",this._oListFilterState.aFilter.length>0);t.setProperty("/filterBarLabel",this.getResourceBundle().getText("masterFilterBarText",[e]))}})});